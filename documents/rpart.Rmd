---
title: "Predict Profesion with rpart"
author: "Aaron"
date: "7/12/2018"
output:
  html_document:
    code_folding: hide
    number_sections: yes
    toc: yes
    toc_float: yes
---
  
```{r setup, include=FALSE}
library(here)
library(tidyverse)
library(recipes)
library(rsample)
library(rpart)
library(pander)
library(DescTools)

source(here("scripts", "00functions.R"))
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = FALSE)
knitr::opts_chunk$set(cache.lazy = FALSE)
knitr::read_chunk(here("scripts", "01load.R"))
knitr::read_chunk(here("scripts", "02preprocess.R"))
knitr::read_chunk(here("scripts", "03rpart.R"))
knitr::read_chunk(here("scripts", "04measures.R"))
```

# Preparation

```{r preparation, child = here("documents", "preparation.Rmd")}
```

```{r recipe}
```

# Classifikation Tree

```{r rpart}
```

## Calc Measures

```{r prediction}
```

```{r decide}
```

```{r accuracy}
```

```{r cramerv}
```

```{r multiAUC}
```

## Best Hyperparameter

```{r}
best_hyper <- data_cv %>%
  group_by(minsplit, minbucket) %>%
  summarise_at(vars(acc, CramerV, multAUC), mean) %>% 
  gather(measure, value, acc, CramerV, multAUC) %>% 
  group_by(measure) %>% 
  filter(value == max(value)) %>% 
  slice(1L)

pander(best_hyper)
```

```{r}
recipe %>%
  prep(data, retain = TRUE) %>%
  fit_rpart(model = TRUE, minsplit = best_hyper$minsplit[[1]],
            minbucket = best_hyper$minbucket[[1]]) %>% 
  rpart.plot(fallen.leaves = F)

data_cv %>%
  filter(minsplit == best_hyper$minsplit[[1]], minbucket == best_hyper$minbucket[[1]]) %>% 
  ggplot(aes(acc)) +
  geom_density(fill = "lightgrey") +
  theme_minimal()

data_cv %>%
  filter(minsplit == best_hyper$minsplit[[1]], minbucket == best_hyper$minbucket[[1]]) %>% 
  ggplot(aes(CramerV)) +
  geom_density(fill = "lightgrey") +
  theme_minimal()

data_cv %>%
  filter(minsplit == best_hyper$minsplit[[1]], minbucket == best_hyper$minbucket[[1]]) %>% 
  ggplot(aes(multAUC)) +
  geom_density(fill = "lightgrey") +
  theme_minimal()
```

